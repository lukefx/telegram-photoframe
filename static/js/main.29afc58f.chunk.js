(this["webpackJsonpphotoframe-react"]=this["webpackJsonpphotoframe-react"]||[]).push([[0],{33:function(e,t,n){},34:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n(9),i=n.n(r),o=n(21),c=n(6),s=n(2),u=n.n(s),d=n(5),l=n(4),p=n(16),h=n.n(p),f=n(1),b=Object(a.createContext)();function j(e){var t=Object(a.useState)(),n=Object(l.a)(t,2),r=n[0],i=n[1],s=Object(a.useState)(),p=Object(l.a)(s,2),j=p[0],g=p[1],v=Object(a.useRef)(),O=Object(a.useState)(),m=Object(l.a)(O,2),x=m[0],y=m[1],w=Object(a.useState)([]),_=Object(l.a)(w,2),C=_[0],k=_[1],S=Object(a.useState)(0),I=Object(l.a)(S,2),z=I[0],E=I[1],P=function(){var e=Object(d.a)(u.a.mark((function e(t,n){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",r.send({"@type":"sendMessage",chat_id:t,reply_to_message_id:0,input_message_content:{"@type":"inputMessageText",text:{"@type":"formattedText",text:n,entities:[]}}}));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),N=function(){var e=Object(d.a)(u.a.mark((function e(){var t,n,a,i=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:"9223372036854775807",n=i.length>1&&void 0!==i[1]?i[1]:0,a=i.length>2&&void 0!==i[2]?i[2]:20,console.log("getChats"),e.abrupt("return",r.send({"@type":"getChats",chat_list:{"@type":"chatListMain"},offset_order:t,offset_chat_id:n,limit:a}));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),R=function(){var e=Object(d.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("getChat",t),e.abrupt("return",r.send({"@type":"getChat",chat_id:t}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),L=function(){var e=Object(d.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Download file",t),e.next=3,r.send({"@type":"downloadFile",file_id:t,priority:1,synchronous:!0});case 3:return e.abrupt("return",r.send({"@type":"readFile",file_id:t}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),M=Object(a.useCallback)(function(){var e=Object(d.a)(u.a.mark((function e(t){var n,a,i,o=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=o.length>1&&void 0!==o[1]?o[1]:0,a=o.length>2&&void 0!==o[2]?o[2]:100,console.log("getChatHistory",t,n),!r){e.next=9;break}return E((function(e){return e+1})),e.next=7,r.send({"@type":"getChatHistory",chat_id:t,limit:a,from_message_id:n});case 7:i=e.sent,k((function(e){return Object(c.a)(new Set([].concat(Object(c.a)(i.messages),Object(c.a)(e)))).sort((function(e,t){return e.date-t.date}))}));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[r]);Object(a.useEffect)((function(){if(j&&1===C.length&&1===z){console.log("Refreshing history...");var e=C[0].id;M(j,e)}}),[j,C,M,z]);var D=Object(a.useCallback)((function(e){"updateAuthorizationState"===e["@type"]&&y(e),"updateNewMessage"!==e["@type"]&&"updateDeleteMessages"!==e["@type"]||function(e){var t;switch(console.log(e),e["@type"]){case"updateNewMessage":(null===e||void 0===e||null===(t=e.message)||void 0===t?void 0:t.chat_id)===v.current&&k((function(t){return[].concat(Object(c.a)(t),[null===e||void 0===e?void 0:e.message])}));break;case"updateDeleteMessages":e.chat_id===v.current&&e.message_ids.forEach(function(){var e=Object(d.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:k((function(e){return e.filter((function(e){return e.id!==t}))}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}}(e)}),[]);Object(a.useEffect)((function(){console.log("Initializing tdlib");var e=new h.a({useTestDC:!1,readOnly:!1,verbosity:3,jsVerbosity:3,fastUpdating:!0,useDatabase:!1,mode:"wasm"});e.onUpdate=D,i(e)}),[D]),Object(a.useEffect)((function(){r&&(console.log("setTdlibParameters"),r.send({"@type":"setTdlibParameters",parameters:{"@type":"tdParameters",use_test_dc:!1,api_id:"10726",api_hash:"f896fe83f2e0a25b99b44c9aad2421f3",system_language_code:navigator.language||"en",device_model:"Telegram Frame",application_version:"0.1",use_secret_chats:!1,use_message_database:!0,use_file_database:!0,files_directory:"/"}}))}),[r]);return console.log("Current history:",C),Object(f.jsx)(b.Provider,Object(o.a)({value:{client:r,chatId:j,saveChatId:function(e){v.current=e,g(e)},event:x,history:C,getChat:R,getChats:N,getChatHistory:M,sendTextMessage:P,downloadFile:L}},e))}function g(){var e=Object(a.useContext)(b);if(void 0===e)throw new Error("useTdlib must be used within a TelegramProvider");return e}var v=n(3),O=n(17),m=n.n(O),x=n.p+"static/media/tg_logo.eea735da.png",y=v.a.div({display:"grid",placeItems:"center",height:600,backgroundColor:"rgba(238, 243, 246, 0.8)"});function w(e){var t=e.event,n=g().client,r=Object(a.useRef)();return Object(a.useEffect)((function(){function e(){return(e=Object(d.a)(u.a.mark((function e(){var a,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=t.authorization_state["@type"],e.t0=a,e.next="authorizationStateClosed"===e.t0?4:"authorizationStateWaitEncryptionKey"===e.t0?8:"authorizationStateWaitPhoneNumber"===e.t0?11:"authorizationStateWaitOtherDeviceConfirmation"===e.t0?14:18;break;case 4:return e.next=6,n.send({"@type":"destroy"});case 6:return window.location.reload(),e.abrupt("break",19);case 8:return e.next=10,n.send({"@type":"checkDatabaseEncryptionKey"});case 10:return e.abrupt("break",19);case 11:return e.next=13,n.send({"@type":"requestQrCodeAuthentication",other_user_ids:[]});case 13:return e.abrupt("break",19);case 14:return i=new m.a({width:400,height:400,data:t.authorization_state.link,image:x,dotsOptions:{color:"#25abec",type:"square"},backgroundOptions:{color:"transparent"},imageOptions:{crossOrigin:"anonymous",margin:20}}),r.current.innerHTML="",i.append(r.current),e.abrupt("break",19);case 18:return e.abrupt("break",19);case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}n&&(null===t||void 0===t?void 0:t.authorization_state)&&function(){e.apply(this,arguments)}()}),[n,t]),Object(f.jsxs)(y,{children:[Object(f.jsx)("h1",{children:"Login with your device"}),Object(f.jsx)("div",{ref:r})]})}var _=n(7);function C(e){var t=e.fileId,n=e.render,r=g().downloadFile,i=Object(a.useState)(),o=Object(l.a)(i,2),c=o[0],s=o[1];return Object(a.useEffect)((function(){var e=!0;function n(){return(n=Object(d.a)(u.a.mark((function n(){var a;return u.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t){n.next=2;break}return n.abrupt("return");case 2:return n.next=4,r(t);case 4:a=n.sent,e&&s(URL.createObjectURL(a.data));case 6:case"end":return n.stop()}}),n)})))).apply(this,arguments)}return function(){n.apply(this,arguments)}(),function(){return e=!1}}),[t,r]),n&&n({blob:c})}var k=v.a.div.withConfig({displayName:"RoundChatPicture",componentId:"sc-3bw7hi-0"})((function(e){var t=e.size,n=void 0===t?100:t,a=e.src;return{height:n,width:n,borderRadius:"50%",backgroundImage:"url(".concat(a,")"),backgroundPosition:"center",backgroundRepeat:"no-repeat",backgroundSize:"cover",backgroundColor:"rgba(238, 243, 246, 0.8)"}})),S=v.a.div.withConfig({displayName:"ChatSelection__ListContainer",componentId:"sc-1r1tjet-0"})({scrollDirection:"vertical"}),I=v.a.ul.withConfig({displayName:"ChatSelection__List",componentId:"sc-1r1tjet-1"})({listStyle:"none",margin:0,padding:0}),z=v.a.li.withConfig({displayName:"ChatSelection__Chat",componentId:"sc-1r1tjet-2"})({padding:10,fontSize:"2rem","&:nth-child(odd)":{background:"rgba(238, 243, 246, 0.8)"}});function E(){var e=g(),t=e.client,n=e.getChat,r=e.getChats,i=e.saveChatId,o=Object(a.useState)([]),s=Object(l.a)(o,2),p=s[0],h=s[1];return Object(a.useEffect)((function(){function e(){return(e=Object(d.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r();case 2:e.sent.chat_ids.map(function(){var e=Object(d.a)(u.a.mark((function e(t){var a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n(t);case 2:a=e.sent,h((function(e){var n,r;return[].concat(Object(c.a)(e),[{id:t,title:a.title,chatPhotoId:null===a||void 0===a||null===(n=a.photo)||void 0===n||null===(r=n.small)||void 0===r?void 0:r.id}])}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[t,n,r]),Object(f.jsxs)(S,{children:[Object(f.jsx)("h1",{children:"Select a chat to use as Frame:"}),Object(f.jsx)(I,{children:p.map((function(e){return Object(f.jsx)(z,{onClick:function(t){return i(e.id)},children:Object(f.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[Object(f.jsx)(C,{fileId:e.chatPhotoId,render:function(e){return Object(f.jsx)(k,{size:100,src:e.blob})}}),Object(f.jsx)("div",{style:{marginLeft:30},children:e.title})]})},e.id)}))})]})}var P=v.a.div.withConfig({displayName:"EmptyChat__Container",componentId:"jss9dm-0"})({display:"grid",placeItems:"center",height:"100vh"}),N=v.a.div.withConfig({displayName:"EmptyChat__Message",componentId:"jss9dm-1"})({fontSize:"2rem"});function R(){console.log("Rendering emptyChat");var e=g(),t=e.client,n=e.chatId,r=e.getChat,i=e.getChatHistory,o=Object(a.useState)(null),c=Object(l.a)(o,2),s=c[0],p=c[1],h=Object(a.useState)(),b=Object(l.a)(h,2),j=b[0],v=b[1];return Object(a.useEffect)((function(){n&&i&&i(n)}),[n,i]),Object(a.useEffect)((function(){var e=!0;function t(){return(t=Object(d.a)(u.a.mark((function t(){var a,i,o,c;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r(n);case 2:o=t.sent,c=null===o||void 0===o||null===(a=o.photo)||void 0===a||null===(i=a.big)||void 0===i?void 0:i.id,e&&(p(o.title),v(c));case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return function(){t.apply(this,arguments)}(),function(){return e=!1}}),[t,n,r]),Object(f.jsxs)(P,{children:[Object(f.jsx)(C,{fileId:j,render:function(e){return Object(f.jsx)(k,{size:400,src:e.blob})}}),Object(f.jsxs)(N,{children:["Send a picture to '",s,"' to view it here"]})]})}var L=v.a.div.withConfig({displayName:"Loading__Overlay",componentId:"sc-1ptxpaf-0"})({display:"grid",placeItems:"center",height:"100%",width:"100%",position:"fixed",top:0,right:0,zIndex:999,backgroundColor:"rgba(238, 243, 246, 0.8)",overflowX:"hidden"}),M=v.a.div.withConfig({displayName:"Loading__Container",componentId:"sc-1ptxpaf-1"})({padding:20,display:"grid",placeItems:"center",backgroundColor:"white",boxShadow:"0 0 16px 0 rgba(51,51,51,0.16)",height:150,width:150,borderRadius:"50%"});function D(e){var t=e.message,n=void 0===t?"Loading...":t;return i.a.createPortal(Object(f.jsx)(L,{children:Object(f.jsx)(M,{children:Object(f.jsx)("div",{children:n})})}),document.getElementById("modal-root"))}var T=n(14),F=v.a.button({padding:10,border:"none",font:"inherit",color:"inherit",backgroundColor:"light-grey",borderRadius:"50%",height:50,width:50,fontSize:"1.5rem",margin:5});function W(e){e.client;var t=e.text,n=e.children,a=g(),r=a.chatId,i=a.sendTextMessage,o=Object(T.a)("/pop-down.mp3",{volume:.25}),c=Object(l.a)(o,1)[0],s=Object(T.a)("/pop-up-on.mp3",{volume:.25}),u=Object(l.a)(s,1)[0];return Object(f.jsx)(F,{onMouseDown:c,onMouseUp:function(e){u(),function(e){i(r,e)}(t)},children:n})}var H=v.a.div.withConfig({displayName:"Photo__PhotoContainer",componentId:"sc-12ox8x3-0"})((function(e){var t=e.blob;return{height:600,backgroundImage:"url(".concat(t,")"),backgroundPosition:"center",backgroundRepeat:"no-repeat",backgroundSize:"cover"}}));function U(e){var t=e.fileId;return Object(f.jsx)(C,{fileId:t,render:function(e){return Object(f.jsx)(H,{blob:e.blob})}})}function A(e){var t=e.fileId;return Object(f.jsx)(C,{fileId:t,render:function(e){return Object(f.jsx)("video",{src:e.blob,controls:!0,autoPlay:!0})}})}function B(e){return e.filter((function(e){var t;return["messagePhoto","messageVideo"].includes(null===e||void 0===e||null===(t=e.content)||void 0===t?void 0:t["@type"])}))}var K=v.a.div.withConfig({displayName:"Slideshow__Container",componentId:"dxjitx-0"})({overflow:"hidden",height:600,width:1024,cursor:"none"}),V=v.a.div.withConfig({displayName:"Slideshow__Caption",componentId:"dxjitx-1"})({position:"relative",top:-60,left:"2%",color:"white",fontSize:"2rem"}),q=v.a.div.withConfig({displayName:"Slideshow__Reactions",componentId:"dxjitx-2"})({position:"relative",top:"-15%",left:"85%",display:"flex",flexDirection:"row"});function J(){console.log("Rendering Slideshow");var e=g(),t=e.client,n=e.chatId,r=e.history,i=Object(a.useState)(!0),o=Object(l.a)(i,2),c=o[0],s=o[1],p=Object(a.useState)(),h=Object(l.a)(p,2),b=h[0],j=h[1],v=Object(a.useState)(""),O=Object(l.a)(v,2),m=O[0],x=O[1];return Object(a.useEffect)((function(){function e(){return(e=Object(d.a)(u.a.mark((function e(){var t,n,a,i,o,c,d,l;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s(!0),i=B(r),Object(_.isEmpty)(i)&&j(Object(f.jsx)(D,{message:"No media in this chat..."})),o=Object(_.last)(i),e.t0=null===o||void 0===o||null===(t=o.content)||void 0===t?void 0:t["@type"],e.next="messagePhoto"===e.t0?7:"messageVideo"===e.t0?12:16;break;case 7:return c=o.content.photo,d=Object(_.last)(c.sizes),j(Object(f.jsx)(U,{fileId:d.photo.id})),x(null===(n=o.content)||void 0===n?void 0:n.text),e.abrupt("break",17);case 12:return l=o.content.video,j(Object(f.jsx)(A,{fileId:l.video.id})),x(null===(a=o.content)||void 0===a?void 0:a.text),e.abrupt("break",17);case 16:return e.abrupt("break",17);case 17:s(!1);case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[t,r,n]),Object(f.jsxs)(K,{children:[c&&Object(f.jsx)(D,{}),b,Object(f.jsx)(V,{children:m}),Object(f.jsxs)(q,{children:[Object(f.jsx)(W,{client:t,text:"\u2665\ufe0f",children:"\u2665\ufe0f"}),Object(f.jsx)(W,{client:t,text:"\ud83e\udd70",children:"\ud83e\udd70"})]})]})}function Q(){var e=g(),t=e.chatId,n=e.history;return t?Object(_.isEmpty)(B(n))?Object(f.jsx)(R,{}):Object(f.jsx)(J,{}):Object(f.jsx)(E,{})}n(32),n(33);var X=function(){var e=g(),t=e.client,n=e.event,a=e.updates;if(!n||!n.authorization_state)return Object(f.jsx)(D,{message:"Loading the app..."});switch(n.authorization_state["@type"]){case"authorizationStateWaitEncryptionKey":case"authorizationStateWaitOtherDeviceConfirmation":case"authorizationStateWaitPhoneNumber":case"updateAuthorizationState":case"authorizationStateClosed":return Object(f.jsx)(w,{event:n,client:t});case"authorizationStateReady":return Object(f.jsx)(Q,{updates:a,client:t});default:return null}},G=function(e){e&&e instanceof Function&&n.e(4).then(n.bind(null,36)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,i=t.getLCP,o=t.getTTFB;n(e),a(e),r(e),i(e),o(e)}))};i.a.render(Object(f.jsx)(a.StrictMode,{children:Object(f.jsx)(j,{children:Object(f.jsx)(X,{})})}),document.getElementById("root")),G()}},[[34,1,2]]]);
//# sourceMappingURL=main.29afc58f.chunk.js.map